<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Home Bill Tracker</title>

  <!-- Mobile optimisation -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    * {
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    }

    body {
      margin: 0;
      padding: 16px;
      background: #f5f5f7;
      color: #111;
    }

    h1 {
      text-align: centre;
      font-size: 1.4rem;
      margin-bottom: 8px;
    }

    .balance {
      text-align: centre;
      font-weight: 600;
      margin-bottom: 16px;
    }

    .card {
      background: white;
      border-radius: 16px;
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }

    canvas {
      max-width: 100%;
    }

    .profiles {
      display: flex;
      justify-content: centre;
      gap: 24px;
      margin-top: 12px;
    }

    .profile {
      border-radius: 50%;
      width: 64px;
      height: 64px;
      object-fit: cover;
      border: 3px solid transparent;
      cursor: pointer;
    }

    .profile.active {
      border-color: #007aff;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    input, button {
      padding: 12px;
      font-size: 1rem;
      border-radius: 12px;
      border: 1px solid #ddd;
    }

    button {
      background: #007aff;
      color: white;
      border: none;
      font-weight: 600;
      cursor: pointer;
    }

    button:active {
      opacity: 0.85;
    }

    .expenses {
      margin-top: 12px;
    }

    .expense {
      display: flex;
      justify-content: space-between;
      font-size: 0.9rem;
      padding: 6px 0;
      border-bottom: 1px solid #eee;
    }
  </style>
</head>
<body>

  <h1>Home Bills</h1>
  <div class="balance" id="balanceText"></div>

  <div class="card">
    <canvas id="chart"></canvas>
  </div>

  <div class="card">
    <div class="form-group">
      <input type="number" id="amount" placeholder="Amount (Â£)" step="0.01">
      <input type="text" id="note" placeholder="What was it for?">
      <button onclick="addExpense()">Add expense</button>
    </div>
  </div>

  <div class="card">
    <strong id="expenseTitle"></strong>
    <div class="expenses" id="expenseList"></div>
  </div>

  <div class="profiles">
    <img src="assets/francis.jpg" id="francisBtn" class="profile active" onclick="selectPerson('francis')">
    <img src="assets/fiona.jpg" id="fionaBtn" class="profile" onclick="selectPerson('fiona')">
  </div>

  <script>
    let activePerson = "francis";

    const defaultData = {
      francis: [],
      fiona: []
    };

    const data = JSON.parse(localStorage.getItem("billTrackerData")) || defaultData;

    function saveData() {
      localStorage.setItem("billTrackerData", JSON.stringify(data));
    }

    function total(person) {
      return data[person].reduce((sum, e) => sum + e.amount, 0);
    }

    function updateBalance() {
      const fTotal = total("francis");
      const fiTotal = total("fiona");
      const diff = Math.abs(fTotal - fiTotal) / 2;

      if (fTotal > fiTotal) {
        balanceText.textContent = `Fiona owes Francis Â£${diff.toFixed(2)}`;
      } else if (fiTotal > fTotal) {
        balanceText.textContent = `Francis owes Fiona Â£${diff.toFixed(2)}`;
      } else {
        balanceText.textContent = "All settled up ðŸŽ‰";
      }
    }

    function renderExpenses() {
      expenseTitle.textContent = `${activePerson.charAt(0).toUpperCase() + activePerson.slice(1)}'s expenses`;
      expenseList.innerHTML = "";

      data[activePerson].forEach(e => {
        const div = document.createElement("div");
        div.className = "expense";
        div.innerHTML = `<span>${e.note}</span><span>Â£${e.amount.toFixed(2)}</span>`;
        expenseList.appendChild(div);
      });
    }

    function addExpense() {
      const amount = parseFloat(document.getElementById("amount").value);
      const note = document.getElementById("note").value;

      if (!amount || !note) return;

      data[activePerson].push({
        amount,
        note,
        date: new Date().toISOString()
      });

      document.getElementById("amount").value = "";
      document.getElementById("note").value = "";

      saveData();
      updateAll();
    }

    function selectPerson(person) {
      activePerson = person;
      francisBtn.classList.toggle("active", person === "francis");
      fionaBtn.classList.toggle("active", person === "fiona");
      renderExpenses();
    }

    const ctx = document.getElementById("chart");

    const chart = new Chart(ctx, {
      type: "doughnut",
      data: {
        labels: ["Francis", "Fiona"],
        datasets: [{
          data: [0, 0],
          backgroundColor: ["#007aff", "#ff2d55"]
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: {
            position: "bottom"
          }
        }
      }
    });

    function updateChart() {
      chart.data.datasets[0].data = [
        total("francis"),
        total("fiona")
      ];
      chart.update();
    }

    function updateAll() {
      updateChart();
      updateBalance();
      renderExpenses();
    }

    updateAll();
  </script>

</body>
</html>
